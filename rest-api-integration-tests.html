
<!DOCTYPE HTML>
<html lang="en" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>REST API Integration Â· Effective Software Testing</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="Ham Vocke">
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="third-party-integration-tests.html" />
    
    
    <link rel="prev" href="database-integration-tests.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Effective Software Testing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="importance-of-automation.html">
            
                <a href="importance-of-automation.html">
            
                    
                    The Importance of (Test) Automation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="tools-and-libraries.html">
            
                <a href="tools-and-libraries.html">
            
                    
                    Tools and Libraries We'll Look At
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="sample-application.html">
            
                <a href="sample-application.html">
            
                    
                    The Sample Application
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="unit-tests.html">
            
                <a href="unit-tests.html">
            
                    
                    Unit Tests
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="test-structure.html">
            
                <a href="test-structure.html">
            
                    
                    Test Structure
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="unit-test-example.html">
            
                <a href="unit-test-example.html">
            
                    
                    Implementing a Unit Test
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="integration-tests.html">
            
                <a href="integration-tests.html">
            
                    
                    Integration Tests
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="database-integration-tests.html">
            
                <a href="database-integration-tests.html">
            
                    
                    Database Integration
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.6.2" data-path="rest-api-integration-tests.html">
            
                <a href="rest-api-integration-tests.html">
            
                    
                    REST API Integration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="third-party-integration-tests.html">
            
                <a href="third-party-integration-tests.html">
            
                    
                    Integration With Third-Party Services
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="json-parsing-integration-tests.html">
            
                <a href="json-parsing-integration-tests.html">
            
                    
                    Parsing and Writing JSON
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="ui-tests.html">
            
                <a href="ui-tests.html">
            
                    
                    UI Tests
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="contract-tests.html">
            
                <a href="contract-tests.html">
            
                    
                    Contract Tests
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="consumer-test.html">
            
                <a href="consumer-test.html">
            
                    
                    Consumer Test
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="provider-test.html">
            
                <a href="provider-test.html">
            
                    
                    Provider Test
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="end-to-end-tests.html">
            
                <a href="end-to-end-tests.html">
            
                    
                    End-to-End Tests
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="ui-e2e-test.html">
            
                <a href="ui-e2e-test.html">
            
                    
                    Testing via the Web Interface
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="rest-api-e2e-test.html">
            
                <a href="rest-api-e2e-test.html">
            
                    
                    Testing via the REST API
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="acceptance-tests.html">
            
                <a href="acceptance-tests.html">
            
                    
                    Acceptance Tests
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="exploratory-testing.html">
            
                <a href="exploratory-testing.html">
            
                    
                    Exploratory Testing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="avoid-test-duplication.html">
            
                <a href="avoid-test-duplication.html">
            
                    
                    Avoid Test Duplication
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="conclusion.html">
            
                <a href="conclusion.html">
            
                    
                    Conclusion
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14" data-path="further-reading.html">
            
                <a href="further-reading.html">
            
                    
                    Further Reading
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >REST API Integration</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="rest-api-integration">REST API Integration</h1>
<p>Testing our microservice&apos;s REST API is quite simple. Of course we can write simple unit tests for all <code>Controller</code> classes and call the controller methods directly as a first measure. <code>Controller</code> classes should generally be quite straightforward and focus on request and response handling. Avoid putting business logic into controllers, that&apos;s none of their business (<em>best pun ever...</em>). This makes our unit tests straightforward (or even unnecessary, if it&apos;s too trivial).</p>
<p>As Controllers make heavy use of <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/html/mvc.html" target="_blank">Spring MVC&apos;s</a> annotations for defining endpoints, query parameters and so on we won&apos;t get very far with unit tests. We want to see if our API works as expected: Does it have the correct endpoints, interpret input parameters and answer with correct HTTP status codes and response bodies? To do so, we have to go beyond unit tests.</p>
<p>One way to test our API were to start up the entire Spring Boot service and fire real HTTP requests against our API. With this approach we were on the very top of our test pyramid. Luckily there&apos;s another, a little less end-to-end way.</p>
<p>Spring MVC comes with a nice testing utility we can use: With <a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#boot-features-testing-spring-boot-applications-testing-autoconfigured-mvc-tests" target="_blank">MockMVC</a>we can spin up a small slice of our spring application, use a <abbr title="Domain-Specific Language">DSL</abbr> to fire test requests at our API and check that the returned data is as expected.</p>
<p>Let&apos;s see how this works for the <code>/hello/&lt;lastname&gt;</code> endpoint <code>ExampleController</code>:</p>
<pre><code class="lang-java"><span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ExampleController</span> </span>{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> PersonRepository personRepository;

    <span class="hljs-comment">// shortened for clarity</span>

    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">&quot;/hello/{lastName}&quot;</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">hello</span><span class="hljs-params">(@PathVariable <span class="hljs-keyword">final</span> String lastName)</span> </span>{
        Optional&lt;Person&gt; foundPerson = personRepository.findByLastName(lastName);

        <span class="hljs-keyword">return</span> foundPerson
             .map(person -&gt; String.format(<span class="hljs-string">&quot;Hello %s %s!&quot;</span>, person.getFirstName(), person.getLastName()))
             .orElse(String.format(<span class="hljs-string">&quot;Who is this &apos;%s&apos; you&apos;re talking about?&quot;</span>, lastName));
    }
}
</code></pre>
<p>Our controller calls the <code>PersonRepository</code> in the <code>/hello/&lt;lastname&gt;</code> endpoint. For our tests we need to replace this repository class with a mock to avoid hitting a real database. Even though this is an integration test, we&apos;re testing the REST API integration, not the database integration. That&apos;s why we stub the database in this case. The controller integration test looks as follows:</p>
<pre><code class="lang-java"><span class="hljs-meta">@RunWith</span>(SpringRunner.class)
<span class="hljs-meta">@WebMvcTest</span>(controllers = ExampleController.class)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ExampleControllerIntegrationTest</span> </span>{

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> MockMvc mockMvc;

    <span class="hljs-meta">@MockBean</span>
    <span class="hljs-keyword">private</span> PersonRepository personRepository;

    <span class="hljs-comment">// shortened for clarity</span>

    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">shouldReturnFullName</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>{
        Person peter = <span class="hljs-keyword">new</span> Person(<span class="hljs-string">&quot;Peter&quot;</span>, <span class="hljs-string">&quot;Pan&quot;</span>);
        given(personRepository.findByLastName(<span class="hljs-string">&quot;Pan&quot;</span>)).willReturn(Optional.of(peter));

        mockMvc.perform(get(<span class="hljs-string">&quot;/hello/Pan&quot;</span>))
                .andExpect(content().string(<span class="hljs-string">&quot;Hello Peter Pan!&quot;</span>))
                .andExpect(status().is2xxSuccessful());
    }
}
</code></pre>
<p>I annotated the test class with <code>@WebMvcTest</code> to tell Spring which controller we&apos;re testing. This mechanism instructs Spring to only start the Rest API slice of our application. We won&apos;t hit any repositories so spinning them up and requiring a database to connect to would simply be wasteful.</p>
<p>Instead of relying on the real <code>PersonRepository</code> we replace it with a mock in our Spring context using the <code>@MockBean</code> annotation. This annotation replaces the annotated class with a Mockito mock globally, all classes that are <code>@Autowired</code> will only find the <code>@MockBean</code> in the Spring context and wire that one instead of a real one. In our test methods we can set the behaviour of these mocks exactly as we would in a unit test, it&apos;s a Mockito mock after all.</p>
<p>To use <code>MockMvc</code> we can simply <code>@Autowire</code> a MockMvc instance. In combination with the <code>@WebMvcTest</code> annotation this is all Spring needs to fire test requests against our controller and expect return values and HTTP status codes. The <code>MockMVC</code> DSL is quite powerful and gets you a long way. Fiddle around with it to see what else you can do.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="database-integration-tests.html" class="navigation navigation-prev " aria-label="Previous page: Database Integration">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="third-party-integration-tests.html" class="navigation navigation-next " aria-label="Next page: Integration With Third-Party Services">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"REST API Integration","level":"1.6.2","depth":2,"next":{"title":"Integration With Third-Party Services","level":"1.6.3","depth":2,"path":"third-party-integration-tests.md","ref":"third-party-integration-tests.md","articles":[]},"previous":{"title":"Database Integration","level":"1.6.1","depth":2,"path":"database-integration-tests.md","ref":"database-integration-tests.md","articles":[]},"dir":"ltr"},"config":{"plugins":[],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","author":"Ham Vocke","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"Effective Software Testing","language":"en","gitbook":"*"},"file":{"path":"rest-api-integration-tests.md","mtime":"2017-11-25T11:19:51.424Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2017-11-25T11:59:56.755Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>



<!DOCTYPE HTML>
<html lang="en" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Provider Test Â· Effective Software Testing</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="Ham Vocke">
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="end-to-end-tests.html" />
    
    
    <link rel="prev" href="consumer-test.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Effective Software Testing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="importance-of-automation.html">
            
                <a href="importance-of-automation.html">
            
                    
                    The Importance of (Test) Automation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="tools-and-libraries.html">
            
                <a href="tools-and-libraries.html">
            
                    
                    Tools and Libraries We'll Look At
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="sample-application.html">
            
                <a href="sample-application.html">
            
                    
                    The Sample Application
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="unit-tests.html">
            
                <a href="unit-tests.html">
            
                    
                    Unit Tests
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="test-structure.html">
            
                <a href="test-structure.html">
            
                    
                    Test Structure
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="unit-test-example.html">
            
                <a href="unit-test-example.html">
            
                    
                    Implementing a Unit Test
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="integration-tests.html">
            
                <a href="integration-tests.html">
            
                    
                    Integration Tests
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="database-integration-tests.html">
            
                <a href="database-integration-tests.html">
            
                    
                    Database Integration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="rest-api-integration-tests.html">
            
                <a href="rest-api-integration-tests.html">
            
                    
                    REST API Integration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="third-party-integration-tests.html">
            
                <a href="third-party-integration-tests.html">
            
                    
                    Integration With Third-Party Services
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="json-parsing-integration-tests.html">
            
                <a href="json-parsing-integration-tests.html">
            
                    
                    Parsing and Writing JSON
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="ui-tests.html">
            
                <a href="ui-tests.html">
            
                    
                    UI Tests
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="contract-tests.html">
            
                <a href="contract-tests.html">
            
                    
                    Contract Tests
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="consumer-test.html">
            
                <a href="consumer-test.html">
            
                    
                    Consumer Test
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.8.2" data-path="provider-test.html">
            
                <a href="provider-test.html">
            
                    
                    Provider Test
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="end-to-end-tests.html">
            
                <a href="end-to-end-tests.html">
            
                    
                    End-to-End Tests
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="ui-e2e-test.html">
            
                <a href="ui-e2e-test.html">
            
                    
                    Testing via the Web Interface
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="rest-api-e2e-test.html">
            
                <a href="rest-api-e2e-test.html">
            
                    
                    Testing via the REST API
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="acceptance-tests.html">
            
                <a href="acceptance-tests.html">
            
                    
                    Acceptance Tests
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="exploratory-testing.html">
            
                <a href="exploratory-testing.html">
            
                    
                    Exploratory Testing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="avoid-test-duplication.html">
            
                <a href="avoid-test-duplication.html">
            
                    
                    Avoid Test Duplication
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="conclusion.html">
            
                <a href="conclusion.html">
            
                    
                    Conclusion
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14" data-path="further-reading.html">
            
                <a href="further-reading.html">
            
                    
                    Further Reading
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >Provider Test</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="provider-test-example-the-other-team">Provider Test Example (the other team)</h1>
<p>The provider test has to be implemented by the people providing the weather API. We&apos;re consuming a public API provided by darksky.net. In theory the darksky team would implement the provider test on their end to check that they&apos;re not breaking the contract between their application and our service.</p>
<p>Obviously they don&apos;t care about our meager sample application and won&apos;t implement a CDC test for us. That&apos;s the big difference between a public-facing API and an organisation adopting microservices. Public-facing APIs can&apos;t consider every single consumer out there or they&apos;d become unable to move forward. Within your own organisation, you can -- and should. Your app will most likely serve a handful, maybe a couple dozen of consumers max. You&apos;ll be fine writing provider tests for these interfaces in order to keep a stable system.</p>
<p>The providing team gets the pact file and runs it against their providing service. To do so they implement a provider test that reads the pact file, stubs out some test data and runs the expectations defined in the pact file against their service.</p>
<p>The pact folks have written several libraries for implementing provider tests. Their main <a href="https://github.com/DiUS/pact-jvm" target="_blank">GitHub repo</a> gives you a nice overview which consumer and which provider libraries are available. Pick the one that best matches your tech stack.</p>
<p>For simplicity let&apos;s assume that the darksky API is implemented in Spring Boot as well. In this case they could use the <a href="https://github.com/DiUS/pact-jvm/tree/master/pact-jvm-provider-spring" target="_blank">Spring pact provider</a> which hooks nicely into Spring&apos;s MockMVC mechanisms. A hypothetical provider test that the darksky.net team would implement could look like this:</p>
<pre><code class="lang-java"><span class="hljs-meta">@RunWith</span>(RestPactRunner.class)
<span class="hljs-meta">@Provider</span>(<span class="hljs-string">&quot;weather_provider&quot;</span>) <span class="hljs-comment">// same as in the &quot;provider_name&quot; part in our clientConsumerTest</span>
<span class="hljs-meta">@PactFolder</span>(<span class="hljs-string">&quot;target/pacts&quot;</span>) <span class="hljs-comment">// tells pact where to load the pact files from</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WeatherProviderTest</span> </span>{
    <span class="hljs-meta">@InjectMocks</span>
    <span class="hljs-keyword">private</span> ForecastController forecastController = <span class="hljs-keyword">new</span> ForecastController();

    <span class="hljs-meta">@Mock</span>
    <span class="hljs-keyword">private</span> ForecastService forecastService;

    <span class="hljs-meta">@TestTarget</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> MockMvcTarget target = <span class="hljs-keyword">new</span> MockMvcTarget();

    <span class="hljs-meta">@Before</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">before</span><span class="hljs-params">()</span> </span>{
        initMocks(<span class="hljs-keyword">this</span>);
        target.setControllers(forecastController);
    }

    <span class="hljs-meta">@State</span>(<span class="hljs-string">&quot;weather forecast data&quot;</span>) <span class="hljs-comment">// same as the &quot;given()&quot; part in our clientConsumerTest</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">weatherForecastData</span><span class="hljs-params">()</span> </span>{
        when(forecastService.fetchForecastFor(any(String.class), any(String.class)))
                .thenReturn(weatherForecast(<span class="hljs-string">&quot;Rain&quot;</span>));
    }
}
</code></pre>
<p>You see that all the provider test has to do is to load a pact file (e.g. by using the <code>@PactFolder</code> annotation to load previously downloaded pact files) and then define how test data for pre-defined states should be provided (e.g. using Mockito mocks). There&apos;s no custom test to be implemented. These are all derived from the pact file. It&apos;s important that the provider test has matching counterparts to the <em>provider name</em> and <em>state</em> declared in the consumer test.</p>
<p>I know that this whole CDC thing can be confusing as hell when you get started. Believe me when I say it&apos;s worth taking your time to understand it. If you need a more thorough example, go and check out the <a href="https://github.com/lplotni/pact-example" target="_blank">fantastic example</a> my friend <a href="https://twitter.com/lplotni" target="_blank">Lukasz</a> has written. This repo demonstrates how to write consumer and provider tests using pact. It even features both Java and JavaScript services so that you can see how easy it is to use this approach with different programming languages.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="consumer-test.html" class="navigation navigation-prev " aria-label="Previous page: Consumer Test">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="end-to-end-tests.html" class="navigation navigation-next " aria-label="Next page: End-to-End Tests">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Provider Test","level":"1.8.2","depth":2,"next":{"title":"End-to-End Tests","level":"1.9","depth":1,"path":"end-to-end-tests.md","ref":"end-to-end-tests.md","articles":[{"title":"Testing via the Web Interface","level":"1.9.1","depth":2,"path":"ui-e2e-test.md","ref":"ui-e2e-test.md","articles":[]},{"title":"Testing via the REST API","level":"1.9.2","depth":2,"path":"rest-api-e2e-test.md","ref":"rest-api-e2e-test.md","articles":[]}]},"previous":{"title":"Consumer Test","level":"1.8.1","depth":2,"path":"consumer-test.md","ref":"consumer-test.md","articles":[]},"dir":"ltr"},"config":{"plugins":[],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","author":"Ham Vocke","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"Effective Software Testing","language":"en","gitbook":"*"},"file":{"path":"provider-test.md","mtime":"2017-11-25T11:11:16.577Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2017-11-25T11:59:56.755Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

